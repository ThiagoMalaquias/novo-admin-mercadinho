require "test_helper"

class Payment::CardServiceTest < ActiveSupport::TestCase
  test "should return payment status" do
    payment_return = {"id":"or_m9KE0gXUkpHzn4oe","code":"YGVKAPDF00","amount":45160,"currency":"BRL","closed":true,"items":[{"id":"oi_MqLX8Pi91hn2XakD","type":"product","description":"Receita Federal - Fluência em Dados (Pós-Edital)","amount":45160,"quantity":1,"status":"active","created_at":"2023-03-05T19:36:49Z","updated_at":"2023-03-05T19:36:49Z","code":"68"}],"customer":{"id":"cus_pG1k941fpoS7P4qr","name":"Ademir De Almeida Machado","email":"juridico.ademachado@gmail.com","document":"90319257053","document_type":"cpf","type":"individual","delinquent":false,"created_at":"2023-03-05T19:36:49Z","updated_at":"2023-03-05T19:36:49Z","phones":{"mobile_phone":{"country_code":"55","number":"992730248","area_code":"41"}}},"status":"failed","created_at":"2023-03-05T19:36:49Z","updated_at":"2023-03-05T19:36:50Z","closed_at":"2023-03-05T19:36:49Z","charges":[{"id":"ch_qoJxMRRtJjc3bdbO","code":"YGVKAPDF00","gateway_id":"1233330004","amount":45160,"status":"failed","currency":"BRL","payment_method":"credit_card","created_at":"2023-03-05T19:36:49Z","updated_at":"2023-03-05T19:36:50Z","customer":{"id":"cus_pG1k941fpoS7P4qr","name":"Ademir De Almeida Machado","email":"juridico.ademachado@gmail.com","document":"90319257053","document_type":"cpf","type":"individual","delinquent":false,"created_at":"2023-03-05T19:36:49Z","updated_at":"2023-03-05T19:36:49Z","phones":{"mobile_phone":{"country_code":"55","number":"992730248","area_code":"41"}}},"last_transaction":{"id":"tran_y0a5pmSvoIgV7Wbz","transaction_type":"credit_card","gateway_id":"1233330004","amount":45160,"status":"not_authorized","success":false,"installments":10,"statement_descriptor":"RANI PASSOS","acquirer_name":"pagarme","acquirer_tid":"1233330004","acquirer_nsu":"1233330004","acquirer_message":"Saldo insuficiente","acquirer_return_code":"1016","operation_type":"auth_and_capture","card":{"id":"card_7VZ90ZATdtpWx1aP","first_six_digits":"550209","last_four_digits":"4029","brand":"Mastercard","holder_name":"ADEMIR A MACHADO","exp_month":4,"exp_year":2030,"status":"active","type":"credit","created_at":"2023-03-05T19:36:49Z","updated_at":"2023-03-05T19:36:49Z","billing_address":{"zip_code":"82840380","city":"Curitiba","state":"PR","country":"BR","line_1":"Rua Rio Pelotas"}},"created_at":"2023-03-05T19:36:49Z","updated_at":"2023-03-05T19:36:49Z","gateway_response":{"code":"200","errors":[]},"antifraud_response":{},"metadata":{}},"metadata":{"id":"endereco","street":"Rua Rio Pelotas","zip_code":"82840380","city":"Curitiba","state":"PR","number":"930","neighborhood":"Bairro Alto","country":"BR"}}],"checkouts":[],"metadata":{"id":"endereco","street":"Rua Rio Pelotas","zip_code":"82840380","city":"Curitiba","state":"PR","number":"930","neighborhood":"Bairro Alto","country":"BR"}}
    raise_payment = Payment::CardService.new(nil, nil, nil, nil, {credit_card: "123234"}).payment_return_errors(payment_return)

    assert_equal 'Status: failed - Erro não informado pelo pagarme', raise_payment
  end
end